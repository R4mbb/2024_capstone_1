{% load static %}
<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>developer page</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css'>
  <link rel="stylesheet" href="{% static 'admin_page/css/style.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
<!-- partial:index.partial.html -->
<body class="sidebar-is-reduced">
  <header class="l-header">
    <div class="l-header__inner clearfix">
      <!-- <div class="c-header-icon js-hamburger">
        <div class="hamburger-toggle"><span class="bar-top"></span><span class="bar-mid"></span><span class="bar-bot"></span></div>
      </div>
      <div class="c-header-icon has-dropdown"><span class="c-badge c-badge--red c-badge--header-icon animated swing">13</span><i class="fa fa-bell"></i>
        <div class="c-dropdown c-dropdown--notifications">
          <div class="c-dropdown__header"></div>
          <div class="c-dropdown__content"></div>
        </div>
      </div> -->
      <!-- <div class="c-search">
        <input class="c-search__input u-input" placeholder="Admin Page" type="text"/>
      </div> -->
      <div style="width: 100%; text-align: center; font-size: 30px; color: #0944a2"><b>AMOIN DEVELOPER SERVICE</b></div>
      <div class="header-icons-group">
        <!-- <div class="c-header-icon basket"><span class="c-badge c-badge--blue c-badge--header-icon animated swing">4</span><i class="fa fa-shopping-basket"></i></div> -->
        <div class="c-header-icon logout"><i class="fa fa-power-off"></i></div>
      </div>
    </div>
  </header>
  <div class="l-sidebar">
    <div class="logo">
      <div class="logo__txt">MENU</div>
    </div>
    <div class="l-sidebar__content">
      <nav class="c-menu js-menu">
        <ul class="u-list">
          <li class="c-menu__item is-active" data-toggle="tooltip" title="Fileupload & Result">
            <div class="c-menu__item__inner" onclick="location.href='#'"><i class="far fa-chart-bar"></i>
              <div class="c-menu-item__title"><span>Fileupload & Result</span></div>
            </div>
          </li>
          <!-- <li class="c-menu__item has-submenu" data-toggle="tooltip" title="Modules">
            <div class="c-menu__item__inner"><i class="fa fa-puzzle-piece"></i>
              <div class="c-menu-item__title"><span>Modules</span></div>
              <div class="c-menu-item__expand js-expand-submenu"><i class="fa fa-angle-down"></i></div>
            </div>
            <ul class="c-menu__submenu u-list">
              <li>Payments</li>
              <li>Maps</li>
              <li>Notifications</li>
            </ul>
          </li>
          <li class="c-menu__item has-submenu" data-toggle="tooltip" title="Statistics">
            <div class="c-menu__item__inner"><i class="far fa-chart-bar"></i>
              <div class="c-menu-item__title"><span>Statistics</span></div>
            </div>
          </li>
          <li class="c-menu__item has-submenu" data-toggle="tooltip" title="Gifts">
            <div class="c-menu__item__inner"><i class="fa fa-gift"></i>
              <div class="c-menu-item__title"><span>Gifts</span></div>
            </div>
          </li>
          <li class="c-menu__item has-submenu" data-toggle="tooltip" title="Settings">
            <div class="c-menu__item__inner"><i class="fa fa-cogs"></i>
              <div class="c-menu-item__title"><span>Settings</span></div>
            </div>
          </li>
        -->
        </ul>
      </nav>
    </div>
  </div>
</body>
<main class="l-main">
  <div class="content-wrapper content-wrapper--with-bg">
    <div class="page-title">
      <h1><b>배포 파일 업로드</b></h1>
      <h3>업로드 버튼을 누르면 악성 파일인지 체크하고 업로드를 진행합니다.</h3>
      <form method="post" enctype="multipart/form-data" action="{% url 'file_upload' %}">
        {{ form.as_p }}
        <button type="submit" style="background-color:#184a98">업로드</button>
      </form>
      {% if message %}
        <script>
            alert("{{ message|escapejs }}");
        </script>
      {% endif %}
    </div>
    <br>
    <h1 class="page-title"><b>AI 악성 파일 분석 결과</b></h1>
    <div class="page-content">
      <div style="overflow:hidden; height:auto;">
        <div id="chartContainer">
          <canvas id="myChart"></canvas>
        </div>
        <script>
          fetch('/api/chart-data/')
              .then(response => response.json())  // JSON 형태로 데이터를 받음
              .then(data => {
                  console.log(data);  // 데이터 확인용 콘솔 출력
                  const ctx = document.getElementById('myChart').getContext('2d');
                  const myChart = new Chart(ctx, {
                      type: 'doughnut',  // 도넛 차트
                      data: data,   // 서버에서 받아온 데이터 사용
                      options: {
                          responsive: true,
                          plugins: {
                              title: {
                                  display: true,
                                  text: data.options.plugins.title.text,
                                  font: {
                                    size: 16,
                                },
                              },
                              legend: {
                                  position: 'top',
                              },
                              tooltip: {
                                  callbacks: {
                                      label: function(tooltipItem) {
                                          let value = tooltipItem.raw;
                                          return `Value: ${value}%`;
                                      }
                                  }
                              }
                          }
                      }
                  });
              })
              .catch(error => console.error('Error fetching chart data:', error));  // 오류 처리
      </script>
      
        <style>
          #chartContainer {
            width: 45%;
            height: 45%;
            padding-left: 50px;
            padding-right: 50px;
            position: relative;
          }
        </style>
      </div>
    </div>
    <div style="text-align: center;">
      <a href="{% url 'reset_result' %}" style="margin-top: 10px; display: inline-block; padding: 10px 15px; background-color: #184a98; color: white; text-decoration: none; border-radius: 3px;">초기화</a>
    </div>
  </div>
</main>
<!-- partial -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
<script src='https://use.fontawesome.com/releases/v5.0.8/js/all.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js'></script>
<script  src="{% static 'admin_page/js/script.js' %}"></script>

</body>
</html>
