import pyzipper
import os
import shutil

def decompress_zip(input_file, output_folder, password):
    with pyzipper.AESZipFile(input_file, 'r') as zip_ref:
        zip_ref.pwd = password.encode()
        zip_ref.extractall(output_folder)

binary_path = 'sample/'
binary_name = os.listdir(binary_path)

for filename in binary_name:
    if filename.endswith('.zip'):
        input_zip_file = f'{binary_path}{filename}'
        # 파일 이름에서 확장자를 제외하고 대문자로 변환
        filename_without_ext = filename.split('.')[0].upper()
        output_folder = f'{binary_path}{filename_without_ext}'

        # 압축 해제
        decompress_zip(input_zip_file, output_folder, password="infected")
        os.remove(input_zip_file)

        forder_in_filename = filename_without_ext.lower() + '.exe'
        shutil.move(output_folder + '/' + forder_in_filename, binary_path)
        os.removedirs(output_folder)
        shutil.move(binary_path + forder_in_filename, binary_path + forder_in_filename[:-4].upper())


# 파일 이름을 train.txt에 작성
with open('./train.txt', 'w') as file:
    for i in binary_name:
        i = i.split('.')
        file.write(i[0].lower() + '\n')
